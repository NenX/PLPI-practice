<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>draw.io</title>
<meta http-equiv="refresh" content="0;URL='https://app.diagrams.net/?src=about#HNenX%2Fbook-reading-and-pratice%2Fmain%2Fdraw.io_files%2FUntitled%20Diagram.drawio.html#%7B%22pageId%22%3A%228QTpa3sZaks16LzNXT63%22%7D'"/>
<meta charset="utf-8"/>
</head>
<body>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; agent=\&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36 Edg/130.0.0.0\&quot; version=\&quot;24.7.17\&quot;&gt;&lt;diagram name=\&quot;Db\&quot; id=\&quot;8QTpa3sZaks16LzNXT63\&quot;&gt;&lt;mxGraphModel dx=\&quot;1313\&quot; dy=\&quot;784\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;1700\&quot; pageHeight=\&quot;1100\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;&lt;root&gt;&lt;mxCell id=\&quot;0\&quot;/&gt;&lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot;/&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-2\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;impl&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;DbDropGuard&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// wrapping a `Db` instance. When this is dropped&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// the `Db`&#39;s purge task will be shut down.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;-&amp;amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;DbDropGuard&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;DbDropGuard&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; { &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Db__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Get the shared database. Internally, this is an&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// `Arc`, so a clone only increments the ref count.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;amp;amp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;-&amp;amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Db__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;clone&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;970\&quot; y=\&quot;70\&quot; width=\&quot;560\&quot; height=\&quot;310\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-3\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;#[&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;tokio&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;main&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;main&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;-&amp;amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;mini_redis&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Result&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;()&amp;amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;set_up_logging&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cli&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Cli&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;parse&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;();&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;port&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cli&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;port&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;unwrap_or&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;DEFAULT_PORT&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Bind a TCP listener&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;TcpListener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;bind&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;amp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;format&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;127.0.0.1:&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;{&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;port&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;))&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;server&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;run__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;signal&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;ctrl_c&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;())&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Ok&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(())&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;200\&quot; y=\&quot;40\&quot; width=\&quot;560\&quot; height=\&quot;330\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-4\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;run__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;TcpListener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;impl&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Future&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; (&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;notify_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;broadcast&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;channel&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #b5cea8;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; (&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown_complete_tx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;shutdown_complete_rx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;mpsc&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;channel&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #b5cea8;&amp;quot;&amp;gt;1&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Initialize the listener state&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;server&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db_holder&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;DbDropGuard&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;limit_connections&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Arc&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Semaphore&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;MAX_CONNECTIONS&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;notify_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown_complete_tx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; };&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;tokio&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;select&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;res&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;server&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;text-decoration: underline;&amp;quot;&amp;gt;run&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;if&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;res&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;error&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cause&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; %&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;failed to accept&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// The shutdown signal has been received.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;info&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;shutting down&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Listener&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown_complete_tx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;notify_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;..&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; } &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;server&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// When `notify_shutdown` is dropped, all tasks which have `subscribe`d will&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// receive the shutdown signal and can exit&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;drop&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;notify_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Drop final `Sender` so the `Receiver` below can complete&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;drop&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown_complete_tx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;shutdown_complete_rx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;text-decoration: underline;&amp;quot;&amp;gt;recv&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;200\&quot; y=\&quot;400\&quot; width=\&quot;560\&quot; height=\&quot;970\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-5\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Listener::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(220, 220, 170); text-decoration-line: underline;&amp;quot;&amp;gt;run&amp;lt;/span&amp;gt;(&amp;amp;amp;&amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt; &amp;lt;span style=&amp;quot;color: rgb(86, 156, 214); text-decoration-line: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;) -&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;::&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Result&amp;lt;/span&amp;gt;&amp;amp;lt;()&amp;amp;gt; {&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;info&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;accepting inbound connections&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;loop&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;permit&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;limit_connections&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;clone&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;acquire_owned&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;unwrap&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;();&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;socket&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;text-decoration: underline;&amp;quot;&amp;gt;accept&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Create the necessary per-connection handler state.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;handler&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Handler&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Get a handle to the shared database.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db_holder&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;connection&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Connection&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;socket&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Receive shutdown notifications.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;notify_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;subscribe&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Notifies the receiver half once all clones are&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// dropped.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_shutdown_complete&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown_complete_tx&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;clone&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; };&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;tokio&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;spawn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;move&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Process the connection. If an error is encountered, log it.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;if&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;text-decoration: underline;&amp;quot;&amp;gt;handler&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;text-decoration: underline;&amp;quot;&amp;gt;run&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;error&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cause&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; ?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;err&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;connection error&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;drop&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;permit&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; });&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;980\&quot; y=\&quot;410\&quot; width=\&quot;560\&quot; height=\&quot;770\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-6\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;#[&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;derive&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Clone&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;struct&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Db__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Handle to shared state. The background task will also have an&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// `Arc&amp;amp;lt;Shared&amp;amp;gt;`.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Arc&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1010\&quot; y=\&quot;1430\&quot; width=\&quot;560\&quot; height=\&quot;180\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-8\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;#[&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;derive&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;struct&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;state&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Mutex&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;State&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Notifies the background task handling entry expiration. The background&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// task waits on this to be notified, then checks for expired values or the&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// shutdown signal.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;background_task&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Notify&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1680\&quot; y=\&quot;380\&quot; width=\&quot;560\&quot; height=\&quot;240\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-9\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;#[&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;derive&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;struct&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;State&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;entries&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;HashMap&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;String&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;pub_sub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;HashMap&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;String&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;broadcast&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Sender&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Bytes&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;expirations&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;BTreeSet&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Instant&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;String&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;bool&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Entry in the key-value store&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;#[&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;derive&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;struct&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Entry&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;data&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Bytes&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;expires_at&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Option&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Instant&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1700\&quot; y=\&quot;650\&quot; width=\&quot;520\&quot; height=\&quot;440\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-10\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;    &amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Handler::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(220, 220, 170); text-decoration-line: underline;&amp;quot;&amp;gt;run&amp;lt;/span&amp;gt;(&amp;amp;amp;&amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt; &amp;lt;span style=&amp;quot;color: rgb(86, 156, 214); text-decoration-line: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;) -&amp;amp;gt; &amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;::&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Result&amp;lt;/span&amp;gt;&amp;amp;lt;()&amp;amp;gt; {&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;while&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;is_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;match&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;maybe_frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Some&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;None&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;return&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Ok&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(()),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; };&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cmd&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Command&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;from_frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;frame&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cmd&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;);&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;cmd&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;apply&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;amp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;db&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;amp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;connection&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;, &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;amp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;mut&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;text-decoration: underline;&amp;quot;&amp;gt;self&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;?&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Ok&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(())&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;2230\&quot; y=\&quot;660\&quot; width=\&quot;560\&quot; height=\&quot;570\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-13\&quot; value=\&quot;&amp;lt;div style=&amp;quot;color: #d4d4d4;background-color: #1e1e1e;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 16px;line-height: 22px;white-space: pre;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Routine executed by the background task.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;///&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Wait to be notified. On notification, purge any expired keys from the shared&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// state handle. If `shutdown` is set, terminate the task.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;async&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;purge_expired_tasks__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Arc&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;lt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt;) {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// If the shutdown flag is set, then the task should exit.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;while&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;is_shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Purge all keys that are expired. The function returns the instant at&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// which the **next** key will expire. The worker should wait until the&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// instant has passed then purge again.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;if&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4fc1ff;&amp;quot;&amp;gt;Some&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;purge_expired_keys&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Wait until the next key expires **or** until the background task&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// is notified. If the task is notified, then it must reload its&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// state as new keys have been set to expire early. This is done by&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// looping.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;tokio&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;select&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;time&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;sleep_until&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;when&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt; {}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;_&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;background_task&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;notified&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;() &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;gt; {}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; } &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;else&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// There are no keys expiring in the future. Wait until the task is&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// notified.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;background_task&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;notified&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #c586c0;&amp;quot;&amp;gt;await&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;debug&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;!&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #ce9178;&amp;quot;&amp;gt;&amp;quot;Purge background task shut down&amp;quot;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;}&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;190\&quot; y=\&quot;1390\&quot; width=\&quot;560\&quot; height=\&quot;660\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;mxCell id=\&quot;PH58y2bN7R6VoLnDO8zJ-14\&quot; value=\&quot;&amp;lt;div style=&amp;quot;background-color: rgb(30, 30, 30); font-family: Consolas, &amp;amp;quot;Courier New&amp;amp;quot;, monospace; font-weight: normal; font-size: 16px; line-height: 22px; white-space: pre;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// Create a new, empty, `Db` instance. Allocates shared state and spawns a&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;/// background task to manage key expiration.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;pub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;crate&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;) &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(86, 156, 214);&amp;quot;&amp;gt;fn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Db__::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(220, 220, 170);&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;font color=&amp;quot;#d4d4d4&amp;quot;&amp;gt;() -&amp;amp;gt; &amp;lt;/font&amp;gt;&amp;lt;span style=&amp;quot;color: rgb(78, 201, 176);&amp;quot;&amp;gt;Db__&amp;lt;/span&amp;gt;&amp;lt;font color=&amp;quot;#d4d4d4&amp;quot;&amp;gt; {&amp;lt;/font&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;let&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;=&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Arc&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;state&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Mutex&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;State&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; {&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;entries&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;HashMap&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;pub_sub&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;HashMap&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;expirations&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;BTreeSet&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shutdown&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #569cd6;&amp;quot;&amp;gt;false&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;,&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; }),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;background_task&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;: &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Notify&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;new&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(),&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; });&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;font color=&amp;quot;#d4d4d4&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #6a9955;&amp;quot;&amp;gt;// Start the background task.&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;tokio&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;::&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;spawn&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;purge_expired_tasks__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;(&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;.&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #dcdcaa;&amp;quot;&amp;gt;clone&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;()));&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;font color=&amp;quot;#d4d4d4&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/font&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #4ec9b0;&amp;quot;&amp;gt;Db__&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; { &amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #9cdcfe;&amp;quot;&amp;gt;shared&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;color: rgb(212, 212, 212);&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;color: #d4d4d4;&amp;quot;&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; }&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; style=\&quot;text;whiteSpace=wrap;html=1;\&quot; vertex=\&quot;1\&quot; parent=\&quot;1\&quot;&gt;&lt;mxGeometry x=\&quot;1030\&quot; y=\&quot;1620\&quot; width=\&quot;560\&quot; height=\&quot;440\&quot; as=\&quot;geometry\&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div>
<a style="position:absolute;top:50%;left:50%;margin-top:-128px;margin-left:-64px;" href="https://app.diagrams.net/?src=about#HNenX%2Fbook-reading-and-pratice%2Fmain%2Fdraw.io_files%2FUntitled%20Diagram.drawio.html#%7B%22pageId%22%3A%228QTpa3sZaks16LzNXT63%22%7D" target="_blank"><img border="0" src="https://app.diagrams.net/images/drawlogo128.png"/></a>
</body>
</html>
